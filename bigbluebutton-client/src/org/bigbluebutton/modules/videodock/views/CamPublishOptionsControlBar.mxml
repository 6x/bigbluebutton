<?xml version="1.0" encoding="utf-8"?>
<mx:ControlBar xmlns:mx="http://www.adobe.com/2006/mxml" 
               creationComplete="onCreationComplete()" visible="false">
  <mx:Script>
    <![CDATA[
      import org.bigbluebutton.core.UsersUtil;     
      public var camSettings:CameraSettings;
      
      private function onCreationComplete():void {
        checkIfMacCamera();
        
        if (UsersUtil.amIPresenter()) showResControls(true);
        if (Camera.names.length > 1) showVideoControls(true);  
      }
      
      private function checkIfMacCamera():void {
        for (var i:int = 0; i < Camera.names.length; i++){
          if (Camera.names[i] == "USB Video Class Video") {
            /**
             * Set as default for Macs
             */
            cmbCameraSelector.selectedIndex = i;
          }
        }
      }
      
      private function showVideoControls(show:Boolean):void {
        if (show) {
          this.visible = true;
          btnStartPublish.visible = true;
          cmbCameraSelector.visible = true;
        } else{					
          this.width = 0;
          this.height = 0;
          btnStartPublish.visible = false;
          cmbCameraSelector.visible = false;
          this.visible = false;
        }
      }
      
      private function updateCameraName():void {
        camSettings.useCamera(cmbCameraSelector.selectedIndex.toString());
      }
      
      private function showResControls(show:Boolean):void {
        if (show) cmbResolution.visible = true;
        else cmbResolution.visible = false;
      }
      
      private function setComboResolution():void {
        var res:Array = cmbResolution.selectedLabel.split( "x" );
        setResolution(Number(res[0]), Number(res[1]));
      }
      
      private function setResolution(width:int, height:int):void {
        camSettings.camWidth = width;
        camSettings.camHeight = height;
//        setAspectRatio(camWidth, camHeight);
        
        /**
         * Add timestamp to create a unique stream name. This way we can record	 	
         * stream without overwriting previously recorded streams.	 	
         */	 	
//        var curTime:Number = new Date().getTime();	
//        var uid:String = UsersUtil.getMyUserID();
//        this.streamName = controls.cmbResolution.selectedLabel.concat("-" + uid) + "-" + curTime;
      }
    ]]>
  </mx:Script>
  
    <mx:Button id="btnStartPublish" toolTip="{ResourceUtil.getInstance().getString('bbb.publishVideo.startPublishBtn.toolTip')}" icon="{camIcon}" click="startPublishing()" enabled="false"/>
    <mx:ComboBox id="cmbCameraSelector" dataProvider="{Camera.names}" width="150" visible="false" change="updateCameraName()"/>
    <mx:ComboBox id="cmbResolution" dataProvider="{resolutions}" width="20%" visible="false" change="updateCamera()"/>
</mx:ControlBar>
